name: PRå®‰å…¨æ€§ã‚¬ãƒ¼ãƒ‰

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  pr-safety-check:
    runs-on: ubuntu-latest
    name: PRå®‰å…¨æ€§æ¤œè¨¼

    steps:
      - name: ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: PRã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¤œè¨¼
        run: |
          echo "ğŸ” PRã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¤œè¨¼ã—ã¦ã„ã¾ã™..."
          echo "PRãƒ™ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒª: ${{ github.event.pull_request.base.repo.full_name }}"
          echo "PRãƒ˜ãƒƒãƒ‰ãƒªãƒã‚¸ãƒˆãƒª: ${{ github.event.pull_request.head.repo.full_name }}"
          echo "PRä½œæˆè€…: ${{ github.event.pull_request.user.login }}"
          echo "PRãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒ: ${{ github.event.pull_request.base.ref }}"
          echo "PRãƒ˜ãƒƒãƒ‰ãƒ–ãƒ©ãƒ³ãƒ: ${{ github.event.pull_request.head.ref }}"

          # ãƒ•ã‚©ãƒ¼ã‚¯ã‹ã‚‰ã‚¢ãƒƒãƒ—ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¸ã®PRã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
          if [ "${{ github.event.pull_request.base.repo.full_name }}" = "satnaing/shadcn-admin" ]; then
            echo "âš ï¸ ã“ã‚Œã¯ã‚¢ãƒƒãƒ—ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒªãƒã‚¸ãƒˆãƒªã¸ã®PRã§ã™"
            echo "ğŸ” æ„å›³çš„ãªã‚‚ã®ã‹ã©ã†ã‹æ¤œè¨¼ã—ã¦ã„ã¾ã™..."

            # æ­£ã—ã„ãƒ•ã‚©ãƒ¼ã‚¯ã‹ã‚‰ã®PRã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
            if [ "${{ github.event.pull_request.head.repo.full_name }}" = "BoxPistols/shadcn-admin" ]; then
              echo "âœ… æ­£ã—ã„ãƒ•ã‚©ãƒ¼ã‚¯ï¼ˆBoxPistols/shadcn-adminï¼‰ã‹ã‚‰ã®PRã§ã™"
            else
              echo "âŒ äºˆæœŸã—ãªã„ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã®PRã§ã™"
              exit 1
            fi

            # ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
            if [[ "${{ github.event.pull_request.head.ref }}" =~ ^feature/.+ ]]; then
              echo "âœ… ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒã®PRã¯å—ã‘å…¥ã‚Œå¯èƒ½ã§ã™"
            else
              echo "âš ï¸ è­¦å‘Š: ã‚¢ãƒƒãƒ—ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¸ã®éãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒPRã§ã™"
            fi
          else
            echo "âœ… ãƒ•ã‚©ãƒ¼ã‚¯å†…ã®å†…éƒ¨PRã§ã™"
          fi

      - name: PRã‚¿ã‚¤ãƒˆãƒ«ã¨èª¬æ˜ã‚’ãƒã‚§ãƒƒã‚¯
        run: |
          echo "ğŸ” PRã‚¿ã‚¤ãƒˆãƒ«ã¨èª¬æ˜ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™..."

          PR_TITLE="${{ github.event.pull_request.title }}"
          PR_BODY="${{ github.event.pull_request.body }}"

          echo "PRã‚¿ã‚¤ãƒˆãƒ«: $PR_TITLE"

          # æ…£ä¾‹çš„ãªã‚³ãƒŸãƒƒãƒˆå½¢å¼ã‚’ãƒã‚§ãƒƒã‚¯
          if [[ "$PR_TITLE" =~ ^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .+ ]]; then
            echo "âœ… PRã‚¿ã‚¤ãƒˆãƒ«ã¯æ…£ä¾‹çš„ãªã‚³ãƒŸãƒƒãƒˆå½¢å¼ã«å¾“ã£ã¦ã„ã¾ã™"
          else
            echo "âš ï¸ è­¦å‘Š: PRã‚¿ã‚¤ãƒˆãƒ«ãŒæ…£ä¾‹çš„ãªã‚³ãƒŸãƒƒãƒˆå½¢å¼ã«å¾“ã£ã¦ã„ã¾ã›ã‚“"
            echo "ğŸ’¡ æ¨å¥¨å½¢å¼: feat: èª¬æ˜ ã¾ãŸã¯ fix: èª¬æ˜"
          fi

          # PRã«èª¬æ˜ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
          if [ -n "$PR_BODY" ]; then
            echo "âœ… PRã«èª¬æ˜ãŒã‚ã‚Šã¾ã™"
          else
            echo "âš ï¸ è­¦å‘Š: PRã«èª¬æ˜ãŒã‚ã‚Šã¾ã›ã‚“"
          fi

      - name: ãƒ–ãƒ©ãƒ³ãƒæ¨©é™ã‚’æ¤œè¨¼
        run: |
          echo "ğŸ” ãƒ–ãƒ©ãƒ³ãƒæ¨©é™ã‚’æ¤œè¨¼ã—ã¦ã„ã¾ã™..."

          # ã‚¢ãƒƒãƒ—ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®main/developã¸ã®PRã®å ´åˆã€è¿½åŠ æ¤œè¨¼ã‚’è¡Œã†
          if [ "${{ github.event.pull_request.base.repo.full_name }}" = "satnaing/shadcn-admin" ]; then
            BASE_BRANCH="${{ github.event.pull_request.base.ref }}"

            if [ "$BASE_BRANCH" = "main" ] || [ "$BASE_BRANCH" = "develop" ]; then
              echo "âš ï¸ ã‚¢ãƒƒãƒ—ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ä¿è­·ã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒ ($BASE_BRANCH) ã¸ã®PRã§ã™"
              echo "ğŸ” ã“ã‚Œã¯æ…é‡ãªãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦ã§ã™"
            fi
          fi

      - name: æ¦‚è¦
        run: |
          echo "ğŸ“‹ PRå®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯æ¦‚è¦:"
          echo "âœ… ãƒªãƒã‚¸ãƒˆãƒªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒæ¤œè¨¼ã•ã‚Œã¾ã—ãŸ"
          echo "âœ… ãƒ–ãƒ©ãƒ³ãƒæ¨©é™ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"
          echo "âœ… PRå½¢å¼ãŒæ¤œè¨¼ã•ã‚Œã¾ã—ãŸ"
          echo "ğŸ‰ ã™ã¹ã¦ã®å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸï¼"
